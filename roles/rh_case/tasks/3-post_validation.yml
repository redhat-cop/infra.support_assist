# --- Post Validation Tasks for Red Hat Support Case Creation Role ---
---
- name: Post Validation | Print on screen role execution status.
  ansible.builtin.debug:
    msg:
      - "{{ separator_char * (message_text | length + default_message_padding) | int }}"
      - " {{ message_text }} "
      - "{{ separator_char * (message_text | length + default_message_padding) | int }}"
  vars:
    message_text: "Executing Post-Case Creation Validation Steps and Fact Setting"
  run_once: true

- name: "Post Validation | Verify API response and case creation success"
  ansible.builtin.assert:
    that:
      - case_creation_result is defined
      - case_creation_result.status == 201
      - case_creation_result.json.location is defined
      - (case_creation_result.json.location[0].split('/')[-1] | default('')) | length > 0
    fail_msg: >-
      FAILED! Oh, No! => Case creation failed!
      HTTP Status: {{ case_creation_result.status | default('N/A') }}
      Response Body: {{ case_creation_result.content | default('N/A') }}
    success_msg: >-
      PASSED! Oh, Yes! => Case created successfully!
      HTTP {{ case_creation_result.status }} | Case ID: {{ case_creation_result.json.location[0].split('/')[-1] }}, Proceeding to next step...
  run_once: true

- name: Post Validation | Extract Case ID from URL and set as global fact
  ansible.builtin.set_fact:
    new_case_id: "{{ case_creation_result.json.location[0].split('/')[-1] }}"
  run_once: true

- name: Post Validation | Print on screen role completion status.
  ansible.builtin.debug:
    msg:
      - "{{ separator_char * (message_text | length + default_message_padding) | int }}"
      - " {{ message_text }} "
      - "{{ separator_char * (message_text | length + default_message_padding) | int }}"
  vars:
    message_text: "Completed Post-Validation for Red Hat Support Case Creation"
  run_once: true

...
