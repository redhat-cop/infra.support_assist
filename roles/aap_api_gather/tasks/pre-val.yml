---
# Pre-validation tasks for aap_api_gather role
# All variables are now role-prefixed to avoid precedence conflicts

- name: Pre-Validation | Ensure hostname is provided for controller/gateway components
  when: "'controller' in aap_api_gather_components or 'gateway' in aap_api_gather_components"
  ansible.builtin.assert:
    that:
      - aap_api_gather_aap_hostname is defined
      - aap_api_gather_aap_hostname | length > 0
    fail_msg: "AAP hostname is required for controller/gateway components. Please provide 'aap_hostname' as an extra-var or set the 'AAP_HOSTNAME', 'CONTROLLER_HOST', or 'TOWER_HOST' environment variable."
    quiet: true

- name: Pre-Validation | Ensure hub URL or hostname is provided if hub component is selected
  when: "'hub' in aap_api_gather_components"
  ansible.builtin.assert:
    that:
      - (aap_api_gather_aap_hub_url | length > 0) or (aap_api_gather_aap_hostname | length > 0)
    fail_msg: "AAP Hub URL or hostname is required when hub component is selected. Please provide 'aap_hub_url' as an extra-var, set the 'AAP_HUB_URL' environment variable, or provide 'aap_hostname' for fallback."
    quiet: true

- name: Pre-Validation | Ensure EDA URL or hostname is provided if eda component is selected
  when: "'eda' in aap_api_gather_components"
  ansible.builtin.assert:
    that:
      - (aap_api_gather_aap_eda_url | length > 0) or (aap_api_gather_aap_hostname | length > 0)
    fail_msg: "AAP EDA URL or hostname is required when eda component is selected. Please provide 'aap_eda_url' as an extra-var, set the 'AAP_EDA_URL' environment variable, or provide 'aap_hostname' for fallback."
    quiet: true

- name: Pre-Validation | Ensure API Token is provided
  ansible.builtin.assert:
    that:
      - aap_api_gather_aap_token is defined
      - aap_api_gather_aap_token | length > 0
    fail_msg: "AAP API Token is required. Please provide 'aap_token' as an extra-var or set the 'aap_token' environment variable."
    quiet: true

- name: Pre-Validation | Ensure destination base directory exists on control node
  ansible.builtin.file:
    path: "{{ aap_api_gather_dest }}"
    state: directory
    mode: '0755'
  delegate_to: localhost
  run_once: true # Only needs to run once per playbook execution
...
